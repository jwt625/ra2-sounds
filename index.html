<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RA2 Sound Browser - Age of Agents</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: #00ff00;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #00ffff;
        }

        select, button, input {
            width: 100%;
            padding: 10px;
            background: #2a2a2a;
            color: #00ff00;
            border: 2px solid #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
        }

        select:hover, button:hover {
            background: #3a3a3a;
            border-color: #00ffff;
        }

        button {
            background: #004400;
            margin-top: 5px;
        }

        button:active {
            background: #006600;
        }

        .info-panel {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-panel h2 {
            color: #ffff00;
            margin-bottom: 10px;
        }

        .info-row {
            margin: 5px 0;
        }

        .info-label {
            color: #00ffff;
            display: inline-block;
            width: 120px;
        }

        .sound-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-card {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            padding: 15px;
        }

        .action-card h3 {
            color: #ffff00;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .sound-item {
            padding: 8px;
            margin: 5px 0;
            background: #1a1a1a;
            border: 1px solid #004400;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            transition: all 0.2s;
        }

        .sound-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .transcription {
            margin-top: 8px;
            padding: 8px;
            background: #0a0a0a;
            border-left: 3px solid #00ffff;
            color: #00ffff;
            font-size: 11px;
            font-style: italic;
            display: none;
        }

        .sound-item:hover .transcription,
        .sound-item.playing .transcription {
            display: block;
        }

        .sound-item:hover {
            background: #3a3a3a;
            border-color: #00ff00;
        }

        .sound-item.playing {
            background: #004400;
            border-color: #00ffff;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { border-color: #00ffff; }
            50% { border-color: #00ff00; }
        }

        .sound-name {
            font-size: 12px;
            flex: 1;
        }

        .play-btn {
            background: #004400;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 5px 15px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            margin-left: 10px;
            font-size: 12px;
        }

        .play-btn:hover {
            background: #006600;
        }

        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            background: #2a2a2a;
            border: 2px solid #00ff00;
        }

        .error {
            border-color: #ff0000;
            color: #ff0000;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            padding: 15px;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }

        .stat-value {
            color: #ffff00;
            font-size: 24px;
            font-weight: bold;
        }

        .stat-label {
            color: #00ffff;
            font-size: 12px;
            margin-top: 5px;
        }

        .search-box {
            margin-bottom: 20px;
        }

        input[type="text"] {
            width: 100%;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>RA2 SOUND BROWSER</h1>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="totalSounds">-</div>
                <div class="stat-label">TOTAL SOUNDS</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="totalUnits">-</div>
                <div class="stat-label">UNITS</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="currentlyPlaying">-</div>
                <div class="stat-label">NOW PLAYING</div>
            </div>
        </div>

        <div class="search-box">
            <label for="search">Search Sounds:</label>
            <input type="text" id="search" placeholder="Search by unit name, action, filename, or transcript text...">
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="category">Category:</label>
                <select id="category">
                    <option value="">-- Select Category --</option>
                </select>
            </div>

            <div class="control-group">
                <label for="unit">Unit:</label>
                <select id="unit" disabled>
                    <option value="">-- Select Unit --</option>
                </select>
            </div>

            <div class="control-group">
                <button id="playAllBtn" disabled>Play All Sounds (Sequential)</button>
            </div>
        </div>

        <div class="info-panel" id="unitInfo" style="display: none;">
            <h2>Unit Information</h2>
            <div class="info-row"><span class="info-label">Name:</span><span id="unitName"></span></div>
            <div class="info-row"><span class="info-label">Faction:</span><span id="unitFaction"></span></div>
            <div class="info-row"><span class="info-label">Role:</span><span id="unitRole"></span></div>
            <div class="info-row"><span class="info-label">Description:</span><span id="unitDesc"></span></div>
        </div>

        <div class="status" id="status">
            Loading configuration...
        </div>

        <div class="sound-grid" id="soundGrid">
            <!-- Sound cards will be populated here -->
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        let config = null;
        let transcriptions = null;
        let currentAudio = null;
        let currentlyPlayingElement = null;
        let allSoundsQueue = [];
        let isPlayingAll = false;

        const audioPlayer = document.getElementById('audioPlayer');

        // Load config and transcriptions
        Promise.all([
            fetch('ra2_sound_config.json').then(r => r.json()),
            fetch('ra2_transcriptions.json').then(r => r.json()).catch(() => null)
        ])
            .then(([configData, transcriptData]) => {
                config = configData;
                transcriptions = transcriptData;
                if (!transcriptions) {
                    console.warn('Transcriptions not found, will display without transcripts');
                }
                initializeApp();
            })
            .catch(error => {
                document.getElementById('status').textContent = 'Error: ' + error.message;
                document.getElementById('status').classList.add('error');
            });

        function initializeApp() {
            populateCategories();
            updateStats();

            document.getElementById('category').addEventListener('change', onCategoryChange);
            document.getElementById('unit').addEventListener('change', onUnitChange);
            document.getElementById('search').addEventListener('input', onSearch);
            document.getElementById('playAllBtn').addEventListener('click', playAllSounds);

            audioPlayer.addEventListener('ended', onAudioEnded);

            document.getElementById('status').textContent = 'Ready! Select a category or use search to explore sounds.';
        }

        function populateCategories() {
            const categorySelect = document.getElementById('category');
            const categories = Object.keys(config).filter(
                k => k !== 'agent_personality_presets' && k !== 'action_mappings'
            ).sort();

            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat.charAt(0).toUpperCase() + cat.slice(1).replace('_', ' ');
                categorySelect.appendChild(option);
            });

            // Add VoiceLines and Taunts if transcriptions are available
            if (transcriptions) {
                const voiceLinesOption = document.createElement('option');
                voiceLinesOption.value = 'voice_lines';
                voiceLinesOption.textContent = 'Voice Lines';
                categorySelect.appendChild(voiceLinesOption);

                const tauntsOption = document.createElement('option');
                tauntsOption.value = 'taunts';
                tauntsOption.textContent = 'Taunts';
                categorySelect.appendChild(tauntsOption);
            }
        }

        function updateStats() {
            let totalSounds = 0;
            let totalUnits = 0;

            Object.keys(config).forEach(category => {
                if (category === 'agent_personality_presets' || category === 'action_mappings') return;

                Object.keys(config[category]).forEach(unit => {
                    totalUnits++;
                    const sounds = config[category][unit].sounds || {};
                    Object.values(sounds).forEach(soundList => {
                        totalSounds += soundList.length;
                    });
                });
            });

            document.getElementById('totalSounds').textContent = totalSounds;
            document.getElementById('totalUnits').textContent = totalUnits;
            document.getElementById('currentlyPlaying').textContent = '-';
        }

        function onCategoryChange(e) {
            const category = e.target.value;
            const unitSelect = document.getElementById('unit');

            unitSelect.innerHTML = '<option value="">-- Select Unit --</option>';
            document.getElementById('unitInfo').style.display = 'none';
            document.getElementById('soundGrid').innerHTML = '';
            document.getElementById('playAllBtn').disabled = true;

            if (!category) {
                unitSelect.disabled = true;
                return;
            }

            // Handle special categories (VoiceLines and Taunts)
            if (category === 'voice_lines' || category === 'taunts') {
                unitSelect.disabled = true;
                displaySpecialCategory(category);
                return;
            }

            const units = Object.keys(config[category]).sort((a, b) => {
                const nameA = (config[category][a].name || a).toLowerCase();
                const nameB = (config[category][b].name || b).toLowerCase();
                return nameA.localeCompare(nameB);
            });
            units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit;
                option.textContent = config[category][unit].name || unit.toUpperCase();
                unitSelect.appendChild(option);
            });

            unitSelect.disabled = false;
            document.getElementById('status').textContent = `${units.length} units available in ${category}`;
        }

        function onUnitChange(e) {
            const category = document.getElementById('category').value;
            const unit = e.target.value;

            if (!unit) {
                document.getElementById('unitInfo').style.display = 'none';
                document.getElementById('soundGrid').innerHTML = '';
                document.getElementById('playAllBtn').disabled = true;
                return;
            }

            const unitData = config[category][unit];
            displayUnitInfo(unitData);
            displaySounds(category, unit, unitData);
            document.getElementById('playAllBtn').disabled = false;
        }

        function displayUnitInfo(unitData) {
            document.getElementById('unitName').textContent = unitData.name || 'N/A';
            document.getElementById('unitFaction').textContent = unitData.faction || 'N/A';
            document.getElementById('unitRole').textContent = unitData.role || 'N/A';
            document.getElementById('unitDesc').textContent = unitData.description || 'No description';
            document.getElementById('unitInfo').style.display = 'block';
        }

        function displaySounds(category, unit, unitData) {
            const soundGrid = document.getElementById('soundGrid');
            soundGrid.innerHTML = '';

            const sounds = unitData.sounds || {};
            let totalSoundCount = 0;

            Object.keys(sounds).forEach(action => {
                const soundList = sounds[action];
                totalSoundCount += soundList.length;

                const actionCard = document.createElement('div');
                actionCard.className = 'action-card';

                const actionTitle = document.createElement('h3');
                actionTitle.textContent = `${action.toUpperCase()} (${soundList.length})`;
                actionCard.appendChild(actionTitle);

                soundList.forEach((soundFile, index) => {
                    const soundItem = createSoundItemElement(category, unit, action, soundFile);
                    actionCard.appendChild(soundItem);
                });

                soundGrid.appendChild(actionCard);
            });

            document.getElementById('status').textContent =
                `Loaded ${totalSoundCount} sounds across ${Object.keys(sounds).length} actions`;
        }

        function displaySpecialCategory(category) {
            if (!transcriptions) return;

            const soundGrid = document.getElementById('soundGrid');
            soundGrid.innerHTML = '';

            const folderMap = {
                'voice_lines': 'RA2_VoiceLines',
                'taunts': 'Taunts'
            };

            const folderName = folderMap[category];
            const files = Object.keys(transcriptions)
                .filter(path => path.startsWith(folderName + '/'))
                .sort();

            if (files.length === 0) {
                document.getElementById('status').textContent = `No files found in ${category}`;
                return;
            }

            const actionCard = document.createElement('div');
            actionCard.className = 'action-card';

            const title = document.createElement('h3');
            title.textContent = `${category === 'voice_lines' ? 'Voice Lines' : 'Taunts'} (${files.length})`;
            actionCard.appendChild(title);

            files.forEach(filePath => {
                const fileData = transcriptions[filePath];
                const soundFile = fileData.filename.replace('.mp3', '');
                const folder = category === 'voice_lines' ? 'voice_lines' : 'taunts';

                const soundItem = createSoundItemElement(folder, '', '', soundFile);
                actionCard.appendChild(soundItem);
            });

            soundGrid.appendChild(actionCard);
            document.getElementById('status').textContent = `Loaded ${files.length} ${category === 'voice_lines' ? 'voice lines' : 'taunts'}`;
            document.getElementById('playAllBtn').disabled = false;
        }

        function playSound(soundFile, element) {
            const category = element.dataset.category;

            // Determine the correct folder path
            let basePath = 'RA2_GameSounds/';
            if (category === 'voice_lines') {
                basePath = 'RA2_VoiceLines/';
            } else if (category === 'taunts') {
                basePath = 'Taunts/';
            }

            const soundPath = `${basePath}${soundFile}.mp3`;

            if (currentlyPlayingElement) {
                currentlyPlayingElement.classList.remove('playing');
            }

            element.classList.add('playing');
            currentlyPlayingElement = element;

            audioPlayer.src = soundPath;
            audioPlayer.play().catch(error => {
                console.error('Error playing sound:', error);
                document.getElementById('status').textContent = `Error playing: ${soundFile}`;
                document.getElementById('status').classList.add('error');
                element.classList.remove('playing');
            });

            document.getElementById('currentlyPlaying').textContent = soundFile;
        }

        function onAudioEnded() {
            if (currentlyPlayingElement) {
                currentlyPlayingElement.classList.remove('playing');
                currentlyPlayingElement = null;
            }

            if (isPlayingAll && allSoundsQueue.length > 0) {
                const next = allSoundsQueue.shift();
                playSound(next.soundFile, next.element);
            } else {
                isPlayingAll = false;
                document.getElementById('currentlyPlaying').textContent = '-';
                document.getElementById('playAllBtn').textContent = 'Play All Sounds (Sequential)';
                document.getElementById('playAllBtn').disabled = false;
            }
        }

        function playAllSounds() {
            const soundItems = document.querySelectorAll('.sound-item');
            allSoundsQueue = Array.from(soundItems).map(item => ({
                soundFile: item.dataset.soundFile,
                element: item
            }));

            if (allSoundsQueue.length === 0) return;

            isPlayingAll = true;
            document.getElementById('playAllBtn').textContent = 'Playing...';
            document.getElementById('playAllBtn').disabled = true;

            const first = allSoundsQueue.shift();
            playSound(first.soundFile, first.element);
        }

        function onSearch(e) {
            const searchTerm = e.target.value.toLowerCase();

            if (searchTerm.length < 2) {
                document.getElementById('soundGrid').innerHTML = '';
                document.getElementById('status').textContent = 'Enter at least 2 characters to search';
                return;
            }

            const results = [];

            // Search in config categories
            Object.keys(config).forEach(category => {
                if (category === 'agent_personality_presets' || category === 'action_mappings') return;

                Object.keys(config[category]).forEach(unit => {
                    const unitData = config[category][unit];
                    const unitName = (unitData.name || '').toLowerCase();
                    const unitDesc = (unitData.description || '').toLowerCase();

                    if (unitName.includes(searchTerm) || unitDesc.includes(searchTerm) || unit.includes(searchTerm)) {
                        results.push({ category, unit, unitData, matchType: 'unit' });
                    } else {
                        // Search in sounds
                        const sounds = unitData.sounds || {};
                        Object.keys(sounds).forEach(action => {
                            if (action.includes(searchTerm)) {
                                results.push({ category, unit, unitData, action, matchType: 'action' });
                            } else {
                                sounds[action].forEach(soundFile => {
                                    const transcript = getTranscription(soundFile, category);
                                    const transcriptMatch = transcript && transcript.toLowerCase().includes(searchTerm);

                                    if (soundFile.includes(searchTerm) || transcriptMatch) {
                                        results.push({
                                            category,
                                            unit,
                                            unitData,
                                            action,
                                            soundFile,
                                            matchType: transcriptMatch ? 'transcript' : 'file'
                                        });
                                    }
                                });
                            }
                        });
                    }
                });
            });

            // Search in VoiceLines and Taunts
            if (transcriptions) {
                const specialFolders = {
                    'RA2_VoiceLines': 'voice_lines',
                    'Taunts': 'taunts'
                };

                Object.keys(specialFolders).forEach(folderName => {
                    Object.keys(transcriptions)
                        .filter(path => path.startsWith(folderName + '/'))
                        .forEach(filePath => {
                            const fileData = transcriptions[filePath];
                            const soundFile = fileData.filename.replace('.mp3', '');
                            const transcript = fileData.transcription || '';

                            if (soundFile.toLowerCase().includes(searchTerm) ||
                                transcript.toLowerCase().includes(searchTerm)) {
                                results.push({
                                    category: specialFolders[folderName],
                                    unit: '',
                                    unitData: { name: folderName.replace('RA2_', '').replace('_', ' ') },
                                    action: '',
                                    soundFile: soundFile,
                                    matchType: transcript.toLowerCase().includes(searchTerm) ? 'transcript' : 'file'
                                });
                            }
                        });
                });
            }

            displaySearchResults(results, searchTerm);
        }

        function displaySearchResults(results, searchTerm) {
            const soundGrid = document.getElementById('soundGrid');
            soundGrid.innerHTML = '';

            if (results.length === 0) {
                document.getElementById('status').textContent = `No results found for "${searchTerm}"`;
                return;
            }

            document.getElementById('status').textContent = `Found ${results.length} matches for "${searchTerm}"`;

            results.forEach(result => {
                const { category, unit, unitData, action, soundFile, matchType } = result;

                const actionCard = document.createElement('div');
                actionCard.className = 'action-card';

                const title = document.createElement('h3');
                title.textContent = `${unitData.name || unit.toUpperCase()} - ${category}`;
                actionCard.appendChild(title);

                if (matchType === 'unit') {
                    // Show all sounds for this unit
                    const sounds = unitData.sounds || {};
                    Object.keys(sounds).forEach(act => {
                        sounds[act].forEach(sf => {
                            actionCard.appendChild(createSoundItem(category, unit, act, sf));
                        });
                    });
                } else if (matchType === 'action') {
                    // Show all sounds for this action
                    const sounds = unitData.sounds[action] || [];
                    sounds.forEach(sf => {
                        actionCard.appendChild(createSoundItem(category, unit, action, sf));
                    });
                } else if (matchType === 'file' || matchType === 'transcript') {
                    // Show just this sound file
                    actionCard.appendChild(createSoundItem(category, unit, action, soundFile));
                }

                soundGrid.appendChild(actionCard);
            });
        }

        function getTranscription(soundFile, category) {
            if (!transcriptions) return null;

            // Try different path formats
            const possiblePaths = [
                `RA2_GameSounds/${soundFile}.mp3`,
                `RA2_VoiceLines/${soundFile}.mp3`,
                `Taunts/${soundFile}.mp3`
            ];

            for (const path of possiblePaths) {
                if (transcriptions[path]) {
                    return transcriptions[path].transcription;
                }
            }
            return null;
        }

        function createSoundItemElement(category, unit, action, soundFile) {
            const soundItem = document.createElement('div');
            soundItem.className = 'sound-item';
            soundItem.dataset.category = category;
            soundItem.dataset.unit = unit;
            soundItem.dataset.action = action;
            soundItem.dataset.soundFile = soundFile;

            const header = document.createElement('div');
            header.className = 'sound-item-header';

            const soundName = document.createElement('span');
            soundName.className = 'sound-name';
            soundName.textContent = `${soundFile}.mp3`;

            const playBtn = document.createElement('button');
            playBtn.className = 'play-btn';
            playBtn.textContent = 'PLAY';
            playBtn.onclick = (e) => {
                e.stopPropagation();
                playSound(soundFile, soundItem);
            };

            header.appendChild(soundName);
            header.appendChild(playBtn);
            soundItem.appendChild(header);

            // Add transcription if available
            const transcript = getTranscription(soundFile, category);
            if (transcript) {
                const transcriptionDiv = document.createElement('div');
                transcriptionDiv.className = 'transcription';
                transcriptionDiv.textContent = `"${transcript}"`;
                soundItem.appendChild(transcriptionDiv);
            }

            soundItem.onclick = () => playSound(soundFile, soundItem);

            return soundItem;
        }

        function createSoundItem(category, unit, action, soundFile) {
            const soundItem = createSoundItemElement(category, unit, action, soundFile);

            // Update the sound name to include action for search results
            const soundName = soundItem.querySelector('.sound-name');
            soundName.textContent = `[${action}] ${soundFile}.mp3`;

            return soundItem;
        }
    </script>
</body>
</html>
